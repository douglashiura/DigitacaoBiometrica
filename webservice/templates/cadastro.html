<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Cadastro</title>
    <!-- animation -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.2/animate.min.css">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
    <!-- jquery -->
    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-2.2.4.min.js" type="text/javascript"></script>
  </head>

  <body class="text-center">
  
    <!--==================================================================== FORMULARIO ====================================================================-->
    <div class='form' style="display:block; position:absolute;z-index:100;top:0; width:50%;">
    <form class="form-cadastro">
      <img class="mb-4" src="{{ url_for('static', filename='img/estrutura_incial.png') }}" alt="" width="148" height="148">
      <h1 class="h3 mb-3 font-weight-normal">Cadastre-se</h1>

      <label for="username" class="sr-only">usuario:</label>
      <input type="text" id="username" class="form-control" placeholder="usuario" data-toggle="tooltip" data-placement="top">

      <label for="password" class="sr-only">senha:</label>
      <input type="text" id="password" class="form-control" placeholder="senha" required="">
      <button id="btn_cadastro" type="button" onclick="cadastro()" data-toggle="collapse" aria-expanded="false" class="btn-signup-check btn btn-lg btn-secondary btn-block">Proximo</button>
    </div>
      <div class='user_already_exist' style="display:none; margin-top: 30%; position: absolute; align-items: center;">USUARIO JÁ CADASTRADO</div>

    <div class='typing-form' style="display:none; position:absolute;z-index:100;top:0; width:50%;">
      <h1>Hora de cadastrar seu padrão biometrico, digite o seguinte texto: "Com grandes poderes vem grandes resposabilidades"</h1>
      <input onfocus="text_onfocus();" onkeydown="digitacao_keydown();" onkeyup="digitacao_keyup(event);" type="text" class="form-control" id="try_userpwd" placeholder="Password">
      <button id="btn_cadastro" type="button" onclick="send_biometric()" data-toggle="collapse" aria-expanded="false" class="btn-signup-check btn btn-lg btn-secondary btn-block">cadastrar</button>
    </div>

<script type="text/javascript">
  var usuario_id;
  var gap;
  var key_time = [];
  var gap2;
  var key_time2 = [];

  // result
  var data = []; // [[], [], []]

  function cadastro(){    
      $.ajax({
          type : 'POST',
          url : 'http://127.0.0.1:3000/usuario',
          contentType: 'application/json; charset=UTF-8',
          data : JSON.stringify({'username':username.value, 'password': password.value}),
          dataType : 'json',
			success: function(rdata){
				if(rdata['cadastro_cod']=='UserRegistrySuccess'){
					usuario_id = rdata['id_usuario']
          console.log(usuario_id)
          const form = document.querySelector('.form');
          const typing_form = document.querySelector('.typing-form');
          const exist = document.querySelector('.user_already_exist');
          form.style.display = 'none'
          exist.style.display = 'none'
          typing_form.style.display = 'block'

				}
				else if(rdata['cadastro_cod']=='UsernameAlreadyExist'){
          console.log('Username já cadastrado..');
          const exist = document.querySelector('.user_already_exist');
          exist.style.display = 'block'
          			
				}
			}
		});
  }

  function text_onfocus(){
        now_1 = Date.now();
        now_2 = Date.now();
      }

  function digitacao_keydown(){
        now_3 = Date.now();
        gap2 = (now_3 - now_1) / 1000; 
        key_time2.push(gap2);
        now_1 = now_3;
        gap2 = (now_3 - now_2) / 1000; 
        key_time2.push(gap2);
      }

  function digitacao_keyup() {
        now_2 = Date.now();
        gap2 = (now_2 - now_1) / 1000; 
        key_time2.push(gap2);       
      }

  
    function send_biometric(){
      $.ajax({
          type : 'POST',
          url : 'http://127.0.0.1:3000/biometria',
          contentType: 'application/json; charset=UTF-8',
          data : JSON.stringify({'user_id':usuario_id, 'data':key_time2}),
          dataType : 'json',
			success: function(rdata){
				if(rdata['biometric_cod']=='Success'){
					console.log('sucess')
				}
				else if(rdata['biometric_cod']=='Fail'){
          console.log('fail');
				}
			}
		});
    }
    
      

    </script>

    
  </body>
</html>
